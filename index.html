<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞—Ä—Ç–æ—Ç–µ–∫–∞ –í–∏–Ω–æ–¥–µ–ª—å–Ω–∏</title>
  <style>
    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Georgia', serif;
      background-color: #f8f4ed;
      color: #3b2e2a;
    }
    .container {
      max-width: 1000px;
      margin: 40px auto;
      padding: 0 20px;
      position: relative;
    }
    /* –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è */
    .add-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border: none;
      border-radius: 50%;
      background-color: #7f142e;
      color: #fff;
      font-size: 32px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: background-color 0.3s, width 0.3s, height 0.3s;
      z-index: 1000;
    }
    .add-btn:hover {
      background-color: #5b0a1c;
    }
    /* –°–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ */
    .cards-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .card {
      background-color: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      display: flex;
      flex-direction: column;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background-color: #eae1d9;
      transition: height 0.3s;
    }
    .card-content {
      padding: 16px;
      flex-grow: 1;
    }
    .card-content p {
      margin: 8px 0;
      line-height: 1.4;
    }
    /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ */
    .card-content .instruction-text {
        font-size: 15px;
    }
    .card-content .instruction-text strong {
        color: #5b0a1c;
    }
    .card-content .instruction-text code {
        background-color: #f0e9e0;
        padding: 2px 5px;
        border-radius: 3px;
        font-family: monospace;
    }
    .card-content .instruction-text ol {
        padding-left: 20px; 
        margin: 8px 0; 
        line-height: 1.6;
    }
    .card-content .instruction-text li {
        margin-bottom: 8px;
    }

    .card-actions {
      display: flex;
      justify-content: space-between;
      padding: 8px 16px 16px;
    }
    .card-actions button {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 18px;
      transition: color 0.2s;
    }
    .card-actions .edit-btn:hover {
      color: #7f142e;
    }
    .card-actions .delete-btn:hover {
      color: #c1272d;
    }
    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–æ—Ä–º—ã */
    .form-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s;
      z-index: 1001;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .wine-form {
      background-color: #fff;
      padding: 24px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      animation: slideIn 0.3s;
    }
    @keyframes slideIn {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .wine-form h2 {
      margin-top: 0;
      font-family: 'Palatino Linotype', serif;
      font-size: 24px;
      color: #7f142e;
    }
    .wine-form label {
      display: block;
      margin: 12px 0 4px;
      font-weight: bold;
    }
    .wine-form input[type="file"],
    .wine-form input[type="number"],
    .wine-form input[type="date"],
    .wine-form textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }
    .wine-form textarea {
      resize: vertical;
      height: 100px;
    }
    .form-actions {
      margin-top: 16px;
      text-align: right;
    }
    .form-actions button {
      border: none;
      padding: 10px 16px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      margin-left: 8px;
      transition: background-color 0.3s;
    }
    .form-actions button[type="submit"] {
      background-color: #7f142e;
      color: #fff;
    }
    .form-actions button[type="submit"]:hover {
      background-color: #5b0a1c;
    }
    .form-actions .cancel-btn {
      background-color: #ccc;
    }
    .form-actions .cancel-btn:hover {
      background-color: #aaa;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–∏–Ω–∏-–∏–≥—Ä—ã */
    .game-container {
      background-color: #fff;
      padding: 24px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      text-align: center;
      animation: slideIn 0.3s;
    }
    .game-container h2 {
      margin-top: 0;
      font-family: 'Palatino Linotype', serif;
      font-size: 24px;
      color: #7f142e;
    }
    .game-board {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin: 20px 0;
      perspective: 1000px;
    }
    .game-card {
      width: 100%;
      aspect-ratio: 1 / 1;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s;
      cursor: pointer;
    }
    .game-card.flipped {
      transform: rotateY(180deg);
    }
    .game-card.matched {
      cursor: default;
      opacity: 0.5;
    }
    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 36px;
      border-radius: 5px;
      transition: font-size 0.3s;
    }
    .card-front {
      background: #fff;
      color: #3b2e2a;
      transform: rotateY(180deg);
      border: 1px solid #eae1d9;
    }
    .card-back {
      background: #7f142e;
      color: #fff;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 40" width="20" height="10"><path fill="rgba(255,255,255,0.1)" d="M40 20c10 0 10 20 20 20s10-20 20-20-10-20-20-20S30 0 40 20zM0 20c10 0 10 20 20 20s10-20 20-20-10-20-20-20S-10 0 0 20z"></path></svg>');
    }
    .game-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
    }
    .game-controls button {
      border: none;
      padding: 10px 16px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s;
      background-color: #7f142e;
      color: #fff;
    }
    .game-controls button:hover {
      background-color: #5b0a1c;
    }
    .game-controls .cancel-btn {
      background-color: #ccc;
      color: #333;
    }
    .game-controls .cancel-btn:hover {
      background-color: #aaa;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞–º–∏ */
    .file-controls {
        margin-bottom: 20px;
        padding: 15px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    .file-controls button {
        flex-grow: 1;
        border: 1px solid #7f142e;
        background-color: #fff;
        color: #7f142e;
        padding: 10px 15px;
        border-radius: 4px;
        font-size: 16px;
        font-family: 'Georgia', serif;
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
    }
    .file-controls button:hover {
        background-color: #7f142e;
        color: #fff;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω */
    @media (max-width: 768px) {
      .container {
        margin: 20px auto;
        padding: 0 15px;
      }
      .add-btn {
        width: 55px;
        height: 55px;
        font-size: 28px;
        bottom: 20px;
        right: 20px;
      }
      #gameBtn {
        bottom: 90px;
        right: 20px;
        font-size: 22px;
      }
      .card img {
        height: 180px;
      }
      .game-board {
        gap: 8px;
      }
      .card-face {
        font-size: 28px;
      }
      .game-controls {
        flex-direction: column;
        gap: 15px;
      }
       .game-controls button {
        width: 100%;
       }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="file-controls">
        <button id="loadBtn">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å (–¥–ª—è –±—ç–∫–∞–ø–∞)</button>
        <button id="saveAllBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ (–¥–ª—è –±—ç–∫–∞–ø–∞)</button>
    </div>
    <input type="file" id="fileInput" accept=".json" style="display: none;">

    <button id="addBtn" class="add-btn">+</button>
    <button id="gameBtn" class="add-btn" style="bottom: 100px; font-size: 24px;">üç∑</button>
    
    <div id="cardsContainer" class="cards-container"></div>
  </div>

  <template id="cardTemplate">
    <div class="card" data-id="">
      <img src="" alt="–§–æ—Ç–æ –±—É—Ç—ã–ª–∫–∏">
      <div class="card-content">
        <p class="rating"></p>
        <p class="dates"></p>
        <p class="recipe"></p>
      </div>
      <div class="card-actions">
        <button class="edit-btn">‚úé</button>
        <button class="delete-btn">üóë</button>
      </div>
    </div>
  </template>
  
  <template id="formTemplate">
    <div class="form-modal">
      <form class="wine-form">
        <h2>–ó–∞–ø–∏—Å—å –≤–∏–Ω–∞</h2>
        <label>–§–æ—Ç–æ –±—É—Ç—ã–ª–∫–∏:</label>
        <input type="file" accept="image/*" name="photo">
        <label>–û—Ü–µ–Ω–∫–∞ (0-10):</label>
        <input type="number" name="rating" min="0" max="10" required>
        <label>–î–∞—Ç–∞ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</label>
        <input type="date" name="productionDate" required>
        <label>–î–∞—Ç–∞ –≤—Å–∫—Ä—ã—Ç–∏—è:</label>
        <input type="date" name="openingDate">
        <label>–†–µ—Ü–µ–ø—Ç:</label>
        <textarea name="recipe" required></textarea>
        <div class="form-actions">
          <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button type="button" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </form>
    </div>
  </template>
  
  <div id="gameModal" class="form-modal" style="display: none;">
    <div class="game-container">
      <h2>–ù–∞–π–¥–∏ –ø–∞—Ä—É</h2>
      <div id="gameBoard" class="game-board"></div>
      <div class="game-controls">
          <p>–•–æ–¥—ã: <span id="movesCounter">0</span></p>
          <button id="gameRestartBtn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
          <button id="gameCloseBtn" class="cancel-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <script>
    const defaultInstructionCard = {
      id: 'default-instructions-001',
      photo: 'SuperVine.png',
      isInstruction: true,
      recipe: `
        <div class="instruction-text">
            <strong>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</strong>
            <p>–í–∞—à–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ!</p>
            <strong>–ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã:</strong>
            <ol>
                <li>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏, –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞–ª–µ—Ç—É.</li>
                <li>–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ.</li>
                <li style="color: #c1272d;"><strong>–î–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π:</strong><br>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ" –∏ "–ó–∞–≥—Ä—É–∑–∏—Ç—å", —á—Ç–æ–±—ã –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –∫–æ–º–ø—å—é—Ç–µ—Ä–∞–º–∏ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø.</li>
            </ol>
            <hr style="border: none; border-top: 1px solid #eee; margin: 16px 0;">
            <strong>üñºÔ∏è –ö–∞—Ä—Ç–∏–Ω–∫–∞ —ç—Ç–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏</strong>
            <p>–ß—Ç–æ–±—ã –ø–æ–º–µ–Ω—è—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É, –ø—Ä–æ—Å—Ç–æ –ø–æ–ª–æ–∂–∏—Ç–µ —Ñ–∞–π–ª —Å –∏–º–µ–Ω–µ–º <code>SuperVine.png</code> (–∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ, –Ω–æ —Ç–æ–≥–¥–∞ –∏–∑–º–µ–Ω–∏—Ç–µ –∏–º—è –≤ –∫–æ–¥–µ) –≤ —Ç—É –∂–µ –ø–∞–ø–∫—É, –≥–¥–µ –ª–µ–∂–∏—Ç —ç—Ç–æ—Ç —Ñ–∞–π–ª <code>index.html</code>.</p>
        </div>
      `
    };
    
    let currentWines = [];

    function saveCardsToLocalStorage() {
        localStorage.setItem('wineryCards', JSON.stringify(currentWines));
    }

    function loadCardsOnStartup() {
        const savedCardsJSON = localStorage.getItem('wineryCards');
        if (savedCardsJSON) {
            currentWines = JSON.parse(savedCardsJSON);
        }

        if (currentWines.length === 0) {
            currentWines.push(defaultInstructionCard);
        }
        
        renderCards();
    }

    function downloadJson(object, filename) {
      const jsonString = JSON.stringify(object, null, 2);
      const blob = new Blob([jsonString], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    const cardsContainer = document.getElementById('cardsContainer');
    const loadBtn = document.getElementById('loadBtn');
    const saveAllBtn = document.getElementById('saveAllBtn');
    const fileInput = document.getElementById('fileInput');

    loadBtn.addEventListener('click', () => {
        fileInput.click();
    });

    saveAllBtn.addEventListener('click', () => {
        const winesToSave = currentWines.filter(wine => !wine.isInstruction);
        if (winesToSave.length === 0) {
            alert('–ù–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.');
            return;
        }

        const cardsCount = winesToSave.length;
        const dateStamp = new Date().toISOString().split('T')[0];
        const filename = `winery-backup-${cardsCount}-cards-${dateStamp}.json`;
        
        alert(`–ì–æ—Ç–æ–≤–∏–º –±—ç–∫–∞–ø...\n\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç–æ—á–µ–∫: ${cardsCount}\n–ò–º—è —Ñ–∞–π–ª–∞: ${filename}`);
        
        downloadJson(winesToSave, filename);
    });

    fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = e => {
            try {
                const parsedData = JSON.parse(e.target.result);
                const loadedWines = Array.isArray(parsedData) ? parsedData : [parsedData];

                if (!loadedWines.every(item => typeof item === 'object' && item !== null && 'id' in item)) {
                  throw new Error('–§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –û–∂–∏–¥–∞–ª—Å—è –æ–±—ä–µ–∫—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–ª–∏ –∏—Ö –º–∞—Å—Å–∏–≤.');
                }
                
                const instructionCard = currentWines.find(w => w.isInstruction);
                const existingRealWines = currentWines.filter(w => !w.isInstruction);
                const wineMap = new Map(existingRealWines.map(wine => [wine.id, wine]));
                
                loadedWines.forEach(wine => {
                    wineMap.set(wine.id, wine);
                });
                
                let newRealWinesList = Array.from(wineMap.values());
                
                if (newRealWinesList.length === 0 && instructionCard) {
                    currentWines = [instructionCard];
                } else if (newRealWinesList.length === 0 && !instructionCard) {
                    currentWines = [defaultInstructionCard];
                } else if (instructionCard) {
                    currentWines = [instructionCard, ...newRealWinesList];
                } else {
                    currentWines = newRealWinesList;
                }

                renderCards();
                saveCardsToLocalStorage();
                alert(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ ${loadedWines.length} –∫–∞—Ä—Ç–æ—á–µ–∫. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ.`);
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON-—Ñ–∞–π–ª.\n\n' + error.message);
            }
        };
        reader.onerror = () => {
             alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª.');
        };
        reader.readAsText(file);
        
        event.target.value = '';
    });

    function renderCards() {
      cardsContainer.innerHTML = '';
      currentWines.sort((a, b) => {
          if (a.isInstruction) return -1; // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–≤–∞—è
          if (b.isInstruction) return 1;
          return parseInt(b.id) - parseInt(a.id); // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ –¥–∞—Ç–µ (–æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º)
      });

      currentWines.forEach(wine => {
        const tpl = document.getElementById('cardTemplate');
        const card = tpl.content.cloneNode(true);
        const el = card.querySelector('.card');
        const editBtn = card.querySelector('.edit-btn');
        const deleteBtn = card.querySelector('.delete-btn');
        
        el.dataset.id = wine.id;
        card.querySelector('img').src = wine.photo || '';
        
        if (wine.isInstruction) {
            card.querySelector('.rating').style.display = 'none';
            card.querySelector('.dates').style.display = 'none';
            card.querySelector('.recipe').innerHTML = wine.recipe;
            editBtn.style.display = 'none'; // –ù–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
        } else {
            card.querySelector('.rating').textContent = `–û—Ü–µ–Ω–∫–∞: ${wine.rating}/10`;
            card.querySelector('.dates').textContent = wine.productionDate
              ? `–ò–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–æ: ${new Date(wine.productionDate).toLocaleDateString('ru-RU')}` +
                (wine.openingDate ? `, –í—Å–∫—Ä—ã—Ç–æ: ${new Date(wine.openingDate).toLocaleDateString('ru-RU')}` : '')
              : '';
            card.querySelector('.recipe').textContent = `–†–µ—Ü–µ–ø—Ç:\n${wine.recipe}`;
            editBtn.addEventListener('click', () => openForm(wine));
        }
        
        deleteBtn.addEventListener('click', () => {
          if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É?')) {
            currentWines = currentWines.filter(w => w.id !== wine.id);
            // –ï—Å–ª–∏ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –Ω–∏ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏, –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –æ–±—Ä–∞—Ç–Ω–æ
            if (currentWines.length === 0) {
                 currentWines.push(defaultInstructionCard);
            }
            renderCards();
            saveCardsToLocalStorage();
          }
        });
        cardsContainer.appendChild(card);
      });
    }

    const addBtn = document.getElementById('addBtn');
    addBtn.addEventListener('click', () => openForm());

    function openForm(editWine) {
      const tpl = document.getElementById('formTemplate');
      const modal = tpl.content.cloneNode(true);
      const formEl = modal.querySelector('form');
      document.body.appendChild(modal);

      if (editWine) {
          formEl.elements['rating'].value = editWine.rating;
          formEl.elements['productionDate'].value = editWine.productionDate;
          formEl.elements['openingDate'].value = editWine.openingDate;
          formEl.elements['recipe'].value = editWine.recipe;
      }

      formEl.querySelector('.cancel-btn').addEventListener('click', () => {
          document.body.removeChild(formEl.closest('.form-modal'));
      });
      
      formEl.addEventListener('submit', e => {
        e.preventDefault();
        const fileInput = formEl.elements['photo'];
        const rating = formEl.elements['rating'].value;
        const productionDate = formEl.elements['productionDate'].value;
        const openingDate = formEl.elements['openingDate'].value;
        const recipe = formEl.elements['recipe'].value;
        const id = editWine ? editWine.id : Date.now().toString();
        
        const handleData = (photoData) => {
          const newWine = { id, photo: photoData, rating, productionDate, openingDate, recipe };
          
          if (editWine) {
              const index = currentWines.findIndex(w => w.id === id);
              if (index !== -1) {
                  if (!photoData) newWine.photo = currentWines[index].photo;
                  currentWines[index] = newWine;
              }
          } else {
              // --- –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É, –Ω–µ —É–¥–∞–ª—è—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é ---
              currentWines.push(newWine);
          }

          renderCards();
          saveCardsToLocalStorage();
          document.body.removeChild(formEl.closest('.form-modal'));
        };

        if (fileInput.files && fileInput.files[0]) {
          const reader = new FileReader();
          reader.onload = () => handleData(reader.result);
          reader.readAsDataURL(fileInput.files[0]);
        } else {
          handleData(editWine ? editWine.photo : '');
        }
      });
    }

    document.addEventListener('DOMContentLoaded', loadCardsOnStartup);

    // === –ö–û–î –ú–ò–ù–ò-–ò–ì–†–´ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ===
    const gameBtn = document.getElementById('gameBtn');
    const gameModal = document.getElementById('gameModal');
    const gameCloseBtn = document.getElementById('gameCloseBtn');
    const gameRestartBtn = document.getElementById('gameRestartBtn');
    const gameBoard = document.getElementById('gameBoard');
    const movesCounter = document.getElementById('movesCounter');
    const EMOJIS = ['üçá', 'üç∑', 'üçæ', 'üßÄ', 'ü•ñ', 'üå≥', '‚òÄÔ∏è', 'üíß'];
    const CARDS_CONTENT = [...EMOJIS, ...EMOJIS];
    let flippedCards = [];
    let lockBoard = false;
    let matchesFound = 0;
    let moves = 0;

    function shuffle(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } }
    function initializeGame() { gameBoard.innerHTML = ''; flippedCards = []; lockBoard = false; matchesFound = 0; moves = 0; movesCounter.textContent = moves; shuffle(CARDS_CONTENT); CARDS_CONTENT.forEach(emoji => { const cardElement = document.createElement('div'); cardElement.classList.add('game-card'); cardElement.dataset.emoji = emoji; cardElement.innerHTML = `<div class="card-face card-front">${emoji}</div><div class="card-face card-back"></div>`; cardElement.addEventListener('click', flipCard); gameBoard.appendChild(cardElement); }); }
    function flipCard() { if (lockBoard || this.classList.contains('flipped')) return; this.classList.add('flipped'); flippedCards.push(this); if (flippedCards.length === 2) { lockBoard = true; moves++; movesCounter.textContent = moves; checkForMatch(); } }
    function checkForMatch() { const [firstCard, secondCard] = flippedCards; const isMatch = firstCard.dataset.emoji === secondCard.dataset.emoji; isMatch ? disableCards() : unflipCards(); }
    function disableCards() { const [firstCard, secondCard] = flippedCards; firstCard.removeEventListener('click', flipCard); secondCard.removeEventListener('click', flipCard); firstCard.classList.add('matched'); secondCard.classList.add('matched'); matchesFound++; if (matchesFound === EMOJIS.length) { setTimeout(() => alert(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –Ω–∞—à–ª–∏ –≤—Å–µ –ø–∞—Ä—ã –∑–∞ ${moves} —Ö–æ–¥–æ–≤!`), 500); } resetBoard(); }
    function unflipCards() { setTimeout(() => { flippedCards.forEach(card => card.classList.remove('flipped')); resetBoard(); }, 1000); }
    function resetBoard() { [flippedCards, lockBoard] = [[], false]; }
    gameBtn.addEventListener('click', () => { gameModal.style.display = 'flex'; initializeGame(); });
    gameCloseBtn.addEventListener('click', () => { gameModal.style.display = 'none'; });
    gameRestartBtn.addEventListener('click', initializeGame);
  </script>
</body>
</html>
